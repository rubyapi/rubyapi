# frozen_string_literal: true

require "test_helper"

class RubyReleases::RubyReleasesListTest < ActiveSupport::TestCase
  def setup
    WebMock.enable!

    @release_index = <<~G
      name	url	sha1	sha256	sha512
      ruby-2.6.0	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.0.tar.bz2	b8638eb806efbf7b6af87b24ccc6ad915f262318	c89ca663ad9a6238f4b1ec4d04c7dff630560c6e6eca6d30857c4d394f01a599	ca3daf9acf11d3db2900af21b66231bd1f025427a9d2212b35f6137ca03f77f57171ddfdb99022c8c8bcd730ff92a7a4af54e8a2a770a67d8e16c5807aa391f1
      ruby-2.6.0	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.0.tar.gz	c95f4e86e21390270dad3ebb94491fd42ee2ce69	f3c35b924a11c88ff111f0956ded3cdc12c90c04b72b266ac61076d3697fc072	01f886b0c0782a06315c4a46414e9f2b66ee634ba4349c8e0697f511793ae3c56d2ad3cad6563f2b0fdcedf0ff3eba51b9afab907e7e1ac243475772f8688382
      ruby-2.6.0	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.0.tar.xz	9ddaeba3505d2855460c8c653159fc0ac8928c0f	acb00f04374899ba8ee74bbbcb9b35c5c6b1fd229f1876554ee76f0f1710ff5f	c56eaf85ef7b79deb34ee4590b143c07f4fc83eb79775290761aee5a7c63374659613538a41f25706ed6e19e49d5c67a1014c24d17f29948294c7abd0b0fcea8
      ruby-2.6.0	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.0.zip	a804e63d18da12107e1d101918a3d8f4c5462a27	8a4fb6ca58202495c9682cb88effd804398bd0ef023e3e36f001ca88d8b5855a	16d66ec4a2c6a2e928d5b50e094a5efa481ac6e4d5ed77459d351ef19fe692aa59b68307e3e25229eec5f30ae2f9adae2663bafe9c9d44bfb45d3833d77839d4
      ruby-2.6.1	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.1.tar.bz2	d4c92d9b0057473238df2fd4792454b43976fda3	82c9402920eac9ce777beb3f34eeadc2a3f3ce80f25004bbf54b5ed1280ba099	fc41429491935b89532733b95476ab9f8a4efc310aad8f4c2bd3b68fba08fd7b6e9ac84c6c88ca892022d1ba76435295f3299ea466f9b5453c07d41cb539af59
      ruby-2.6.1	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.1.tar.gz	416842bb5b4ca655610df1f0389b6e21d25154f8	17024fb7bb203d9cf7a5a42c78ff6ce77140f9d083676044a7db67f1e5191cb8	89e016e60f107fa40da251bc9659584ee3191caee726b5c6818ecbe109f825c553041a5dfda7e6d2889fcf587e63fb5d9fbe6cbdbdc4572e1123c302f0f1b881
      ruby-2.6.1	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.1.tar.xz	ba5f4338bb642e3836dd80b73a9df0d1b6e079ae	47b629808e9fd44ce1f760cdf3ed14875fc9b19d4f334e82e2cf25cb2898f2f2	fb36289a955f0596c683cdadf1e4a9a9fd35222b1e1c6160c2e7cd82e5befd40a7aa4361e55f7a8f83c06ee899ec493821c7db34a60c4ac3bca0e874d33ef1a9
      ruby-2.6.1	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.1.zip	6fd14990dc411eb58852324d45b29f84d580644d	ed1537f49d333a809900c1f49ad16c4c06224ebbf5c744cb7b9104ab2a385366	8a092486ecefac5bd734897562257a576112e59d90026d0b2ada10aa0b7e0fa86ed1cd803c6254eaa21b19ba36502d9ac268eae6f5714a6eca01904117ab0da6
      ruby-2.6.2	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.2.tar.bz2	5839fc6e6568ac4f26a20382bd8fe0d998dffbb0	d126ada7f4147ce1029a80c2a37a0c4bfb37e9e82da8816662241a43faeb8915	cad678d2ced4085e99009e4fef83c067dd0e6ead27a8695bc212c0e5112a7fa09ceb27f82638faf91932ef8bdd090f844e0a878ffdf6845a891da4b858588aa0
      ruby-2.6.2	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.2.tar.gz	44c6634a41f63ebdc1f3ce6ddcf48a4766bb4df7	a0405d2bf2c2d2f332033b70dff354d224a864ab0edd462b7a413420453b49ab	bc96a6793a1e3111598b82b0aad98dc5b465e39cdb5b788c4259818752e028a44545c6489c02c323db0f43a362c26f0900acfba0277d6e2201587d7252f6125f
      ruby-2.6.2	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.2.tar.xz	b7b3432519f80ea50adc9bfb937c7a46865a93d5	91fcde77eea8e6206d775a48ac58450afe4883af1a42e5b358320beb33a445fa	13f7d7b483a037378eac4bf4bebddc21d69f4e19e6bbb397dd53e7518037ae9a3aa5b41fc20bf1fe410803c6efc3a6a65a65af47648d3a93713f75cfe885326a
      ruby-2.6.2	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.2.zip	fce5c289842e6e4c4bc7950214d82c0858086baa	65b862e5c86346d6bda05fc193c6f2cd728ddfd357f4b0a19d54d48a50984d13	60ccabbca50d51186b6715edcd8e4fa704e8b9159a23f073e8d3aafef3858a98ade416156af94a479d1af5555c4c4b5b71267f0f563a518e5e6112ce9921bb8b
      ruby-2.6.3	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.3.tar.bz2	aed3bd3c5346b3b85a6b184bb320465d98994fe3	dd638bf42059182c1d04af0d5577131d4ce70b79105231c4cc0a60de77b14f2e	c63c3f527bef88922345f4abb4b9ad467117b63f2132e41722ea6b4234cec3446626c3338e673065a06d2894feee92472807c284cbe613a442c8fda234ea7f88
      ruby-2.6.3	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.3.tar.gz	2347ed6ca5490a104ebd5684d2b9b5eefa6cd33c	577fd3795f22b8d91c1d4e6733637b0394d4082db659fccf224c774a2b1c82fb	8503b86da60e38da4f1a1553b2570d4125c1823280e6fb6d07825a0e92dd7b628e13147ebde085702cbf5c5eddfe7fa5a2445996bc29164196a53bc917b02112
      ruby-2.6.3	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.3.tar.xz	ee231856cee812cfc67440d643f7451857a760c9	11a83f85c03d3f0fc9b8a9b6cad1b2674f26c5aaa43ba858d4b0fcc2b54171e1	959a613f5cf5b3185a1d7a7ba0e1921166b3930f30461b391b1c9fcfe396f56dc3c736123dfc7b4e72c32a97dc5a1eb1fd7f09bcc3793a3c5526f6644ba421c8
      ruby-2.6.3	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.3.zip	85e9ffe707fb1c1eb4131c953530bb01105a5948	5ef6b8e5b5f242d41e4b3d9ab21a40d3f494dfca42b00b25ab8fd3122325fe2d	5c87e1eda0002e95684c08ea4eb55b5ce1941dd6304806117647c0bd44ab0714d50fe3b24c322a4f5978286a5442ceaa2d141ebe7cfe07198e0a0b876af6c004
      ruby-2.6.4	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.4.tar.bz2	fa1c7b7f91edb92de449cb1ae665901ba51a8b81	fa1ecc67b99fa13201499002669412eae7cfbe2c30c4f1f4526e8491edfc5fa7	a9fa2f51fb5f86cd8dcaa0925fe6f13d4f19f110b5d4c5fd251f199d16aaf920db39ad3bb50460eb94ab8d471ab2ac8bb54daea4a3bb080eaf45250aac3437fe
      ruby-2.6.4	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.4.tar.gz	2eaddc428cb5d210cfc256a7e6947196ed24355b	4fc1d8ba75505b3797020a6ffc85a8bcff6adc4dabae343b6572bf281ee17937	3dad0d98695e10ece015933e96114ffd9a10d3c59d1ead8a9ab041df113aabee3f4100aa7ffe7ef5c43b62ac3c7506c3f3ceeb8828b2a800b6d0f4119d5bf926
      ruby-2.6.4	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.4.tar.xz	6ef7d60b8aaa5efb04de2eb4b682f91bc0ab3910	df593cd4c017de19adf5d0154b8391bb057cef1b72ecdd4a8ee30d3235c65f09	930a4162fdb008d2446247908c14269fd13db4dc80bd2bb201a65a69c03f5933f97b4c5079ccd2a12db4934ff97b2debaa10a6c6f5c3060e55873f4397747eaa
      ruby-2.6.4	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.4.zip	3e1d98afc7804a291abe42f0b8e2e98219e41ca3	8446eaaa633a8d55146df0874154b8eb1e5ea5a000d803503d83fd67d9e9372c	5696f2921b8488bde42536dd23d933c8a5ab9ce33632760d217d79567324c4a20f8007d4815f33e56c0a764d1ca372b40c41a5937f9938bb1d63ea078d10d657
      ruby-2.6.5	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.5.tar.bz2	d959802f994594f3296362883b5ce7edf5e6e465	97ddf1b922f83c1f5c50e75bf54e27bba768d75fea7cda903b886c6745e60f0a	28e0b04ac8ca85203eb8939137b5e5de4850c933faf7f62fc69648fe1886faaabf6cdf48382f9d9585c1720876d10b41dafd33efaeb23341c309917fbd8a6e21
      ruby-2.6.5	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.5.tar.gz	1416ce288fb8bfeae07a12b608540318c9cace71	66976b716ecc1fd34f9b7c3c2b07bbd37631815377a2e3e85a5b194cfdcbed7d	7ab7a0cdaf4863152efc86dbcfada7f10ab3fe33590eee3b6ab7b26fc27835a8a0ded4ec02b58e9969175582a2be5410da3dc9f8694a3cd2db97708bd72773e1
      ruby-2.6.5	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.5.tar.xz	575d3f68cbfa753fb07b538824711214f859b9c0	d5d6da717fd48524596f9b78ac5a2eeb9691753da5c06923a6c31190abe01a62	e8ae3b5d4d23a93d0ef6057235ad0e573665a8b4b6544e1c70b4cce9c4d2fb9094e5c8fe8a9ab7b9996efe3ada603f9b4ef1fd08fb5a83253c1ae2b5e3f202db
      ruby-2.6.5	https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.5.zip	66d850ea8275615b1282ef832c34645bbf9ebb16	9455170dd264f69bd92ab0f4f30e5bdfc1ecafe32568114f1588a3850ca6e5fd	b9f54090f982695d92fc555cd1090db34496284edc69e335a16dea0d3189a33847464d1d1b701599bdabad0688efdf43cbbea41426f816a666d8ba7ccae6b5cf
    G

    stub_request(:get, "https://cache.ruby-lang.org/pub/ruby/index.txt").to_return(status: 200, body: @release_index, headers: {})
  end

  def teardown
    WebMock.disable!
  end

  test "fetching ruby releases" do
    releases = RubyReleases::ReleaseList.fetch
    assert_equal releases.size, 8 # Note: a release for 'dev' & Ruby 3 is automatically added
  end
end
